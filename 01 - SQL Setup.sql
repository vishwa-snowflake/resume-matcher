
use role accountadmin;

-- ============================
-- Create database and schemas
-- ============================
create or replace database HACKATHON_2025;

create or replace schema JOBREQS;

use database HACKATHON_2025;
use schema JOBREQS;


-- ============================
-- Create tables in schema JOBREQS
-- ============================


create or replace TABLE BRONZE_JOB_LISTINGS cluster by (ingestion_timestamp)(
	FILENAME VARCHAR(500),
	FILE_ROW_NUMBER NUMBER(38,0),
	INGESTION_TIMESTAMP TIMESTAMP_LTZ(9) DEFAULT CURRENT_TIMESTAMP(),
	RAW_JSON VARIANT
)COMMENT='Bronze layer table storing raw job listing JSON data with metadata'
;
create or replace TABLE JOBREQ_EXTRACTIONS (
	EXTRACTION_TIMESTAMP TIMESTAMP_LTZ(9),
	REQ_ID VARCHAR(16777216),
	CATEGORY VARCHAR(16777216),
	EXTRACTED_INFO OBJECT
);
create or replace TABLE SILVER_JOB_LISTINGS_FLATTENED (
	CLASSIFED VARIANT,
	CATEGORY VARCHAR(16777216),
	REQ_ID VARCHAR(16777216),
	JOB_ID VARCHAR(16777216),
	JOB_TITLE VARCHAR(16777216),
	ORGANIZATION_NAME VARCHAR(16777216),
	ORGANIZATION_URL VARCHAR(16777216),
	DATE_POSTED TIMESTAMP_NTZ(9),
	DATE_CREATED TIMESTAMP_NTZ(9),
	DATE_VALID_THROUGH TIMESTAMP_NTZ(9),
	JOB_DESCRIPTION VARCHAR(16777216)
);


-- create stages
-- =============
CREATE OR ALTER STAGE APPLICATIONS
  ENCRYPTION = (TYPE = 'SNOWFLAKE_SSE')
  DIRECTORY=(ENABLE=true);


CREATE OR ALTER STAGE JOB_LISTINGS_STAGE
  ENCRYPTION = (TYPE = 'SNOWFLAKE_SSE')
  DIRECTORY=(ENABLE=true);



-- ============================
-- Create tables in schema JOE
-- ============================

create or replace schema JOE;
use schema JOE;

create or replace TABLE FLATTENED_RESUME_PDFS (
	FILE_PATH VARCHAR(16777216),
	RESUME_ID VARCHAR(16777216),
	FILE_URL VARCHAR(16777216),
	EXTRACTION_TIMESTAMP TIMESTAMP_LTZ(9),
	CATEGORY VARCHAR(16777216),
	MOST_RECENT_JOB_TITLE VARCHAR(16777216),
	YEARS_OF_EXPERIENCE NUMBER(38,0),
	TECHNICAL_SKILLS VARCHAR(16777216),
	ADDITIONAL_SKILLS VARCHAR(16777216),
	CERTIFICATIONS VARCHAR(16777216),
	JOB_TITLES_LIST VARCHAR(16777216),
	COMMUNITY_VOLUNTEER_BOOL BOOLEAN,
	COMMUNITY_VOLUNTEER VARCHAR(16777216),
	SPOKEN_LANGUAGES_BOOL BOOLEAN,
	SPOKEN_LANGUAGES VARCHAR(16777216),
	PROGRAMMING_LANGUAGES VARCHAR(16777216),
	COLLEGE_SPORTS VARCHAR(16777216),
	COLLEGE_SPORTS_DIVISION VARCHAR(16777216),
	PERSONAL_INTERESTS VARCHAR(16777216),
	INTERESTING VARCHAR(16777216),
	LEADERSHIP_EXPERIENCE_BOOL BOOLEAN,
	LEADERSHIP_EXPERIENCE VARCHAR(16777216),
	HAS_DOCTORATE BOOLEAN,
	HAS_MASTERS BOOLEAN,
	HAS_BACHELORS BOOLEAN,
	HAS_HIGH_SCHOOL_DIPLOMA BOOLEAN,
	DOCTORATE_NAME VARCHAR(16777216),
	MASTERS_NAME VARCHAR(16777216),
	BACHELORS_NAME VARCHAR(16777216),
	FULL_EXTRACTED_JSON OBJECT,
	VECTOR_EMBEDDING_VARIANT VARIANT
);
create or replace TABLE GOLD_TABLE_COMPARISONS (
	FILE_URL_CLICKABLE VARCHAR(16777216),
	REQ_ID VARCHAR(16777216),
	JOB_TITLE VARCHAR(16777216),
	RESUME_ID VARCHAR(16777216),
	VECTOR_EMBEDDING_VARIANT VARIANT,
	VECTOR_EMBEDDING_VARIANT_JOBREQ VARIANT,
	RESUME_TECH_SKILLS VARCHAR(16777216),
	RESUME_YOE NUMBER(38,0),
	REQ_TECH_SKILLS VARCHAR(16777216),
	REQ_YOE NUMBER(38,0),
	RESUME_CURRENT_JOB VARCHAR(16777216),
	RESUME_JOB_TITLE VARCHAR(16777216),
	MATCH_SCORE FLOAT,
	FILE_PATH VARCHAR(16777216),
	FILE_URL VARCHAR(16777216),
	CATEGORY VARCHAR(16777216),
	COMMUNITY_VOLUNTEER_BOOL BOOLEAN,
	COMMUNITY_VOLUNTEER VARCHAR(16777216),
	COLLEGE_SPORTS VARCHAR(16777216),
	COLLEGE_SPORTS_DIVISION VARCHAR(16777216),
	INTERESTING VARCHAR(16777216),
	PERSONAL_INTERESTS VARCHAR(16777216),
	SPOKEN_LANGUAGES VARCHAR(16777216),
	RANK_WITHIN_REQ NUMBER(18,0),
	FIRSTNAME_LASTNAME VARCHAR(16777216)
);
create or replace TABLE JOBREQ_FLATTENED (
	REQ_ID VARCHAR(16777216),
	CATEGORY VARCHAR(16777216),
	JOB_TITLE VARCHAR(16777216),
	YEARS_OF_EXPERIENCE_REQUIRED NUMBER(38,0),
	TECHNICAL_SKILLS_REQUIRED VARCHAR(16777216),
	ADDITIONAL_SKILLS_REQUIRED VARCHAR(16777216),
	CERTIFICATIONS_REQUIRED VARCHAR(16777216),
	JOB_TITLES_LIST VARCHAR(16777216),
	REQUIRES_NON_ENGLISH_LANGUAGES BOOLEAN,
	SPOKEN_LANGUAGES_REQUIRED VARCHAR(16777216),
	PROGRAMMING_LANGUAGES_REQUIRED VARCHAR(16777216),
	REQUIRES_LEADERSHIP_EXPERIENCE BOOLEAN,
	LEADERSHIP_EXPERIENCE_DETAILS VARCHAR(16777216),
	REQUIRES_DOCTORATE BOOLEAN,
	REQUIRES_MASTERS BOOLEAN,
	REQUIRES_BACHELORS BOOLEAN,
	REQUIRES_HIGH_SCHOOL_DIPLOMA BOOLEAN,
	REQUIRED_DOCTORATE_FIELD VARCHAR(16777216),
	REQUIRED_MASTERS_FIELD VARCHAR(16777216),
	REQUIRED_BACHELORS_FIELD VARCHAR(16777216),
	FULL_EXTRACTED_JSON OBJECT,
	VECTOR_EMBEDDING_VARIANT_JOBREQ VARIANT
);
create or replace TABLE KAGGLE_RESUMES (
	ID NUMBER(38,0),
	RESUME_STR VARCHAR(16777216),
	RESUME_HTML VARCHAR(16777216),
	CATEGORY VARCHAR(16777216)
);
create or replace TABLE PARSED_RESUMES (
	ID NUMBER(38,0),
	RESUME_STR VARCHAR(16777216),
	RESUME_HTML VARCHAR(16777216),
	CATEGORY VARCHAR(16777216)
);
create or replace TABLE RESUME_PDF_EXTRACTIONS (
	RELATIVE_PATH VARCHAR(16777216),
	FILE_URL VARCHAR(16777216),
	EXTRACTION_TIMESTAMP TIMESTAMP_LTZ(9),
	CATEGORY VARCHAR(16777216),
	RESUME_ID VARCHAR(16777216),
	EXTRACTED_INFO OBJECT
);


-- create stages
-- =============
CREATE OR ALTER STAGE REQS_RESUMES
  ENCRYPTION = (TYPE = 'SNOWFLAKE_SSE')
  DIRECTORY=(ENABLE=true);


CREATE OR ALTER STAGE RESUME_PDFS
  ENCRYPTION = (TYPE = 'SNOWFLAKE_SSE')
  DIRECTORY=(ENABLE=true);



-- ================================================
-- Create streamlit app  in schema STREAMLIT_SCHEMA
-- ================================================


create or replace schema STREAMLIT_SCHEMA;

create or replace streamlit JT_RS317LGZ8HY3Z/versions/live'
	main_file='streamlit_app.py'
	query_warehouse='COMPUTE_WH'
	comment='{"lastUpdatedUser":"7696508058408","lastUpdatedTime":1758164278919}'
	title='Resume Ranker';




-- ================================================
-- Create transformation processes
-- ================================================









